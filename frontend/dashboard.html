<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Global Collaboration Hub</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar">
        <div class="nav-brand"><i class="fas fa-globe"></i><span>GLOBAL COLLABORATION HUB</span></div>
        <div class="user-menu" id="userMenu" style="display:none;"></div>
        <button class="btn btn-outline" id="logoutBtn">Logout</button>
    </nav>
    <main class="app-shell">
        <aside class="sidebar-nav">
            <a href="dashboard.html"><i class="fas fa-home"></i> Dashboard</a>
            <a href="profile.html"><i class="fas fa-user"></i> Profile</a>
            <a href="students.html"><i class="fas fa-users"></i> Students</a>
            <a href="workspace-invitations.html"><i class="fas fa-envelope-open-text"></i> Invitations</a>
            <a href="requests.html"><i class="fas fa-inbox"></i> Requests</a>
        </aside>
        <section class="content-area">
            <div class="hero card ribbon" id="heroBanner">
                <div>
                    <h1>Collaborate Across Workspaces</h1>
                    <p>Perfect Platform For OpenSource Development Work.</p>
                </div>
                <div class="hero-actions">
                    <button class="btn btn-primary" id="heroActionBtn"><i class="fas fa-rocket"></i> <span id="heroActionText">Get Started</span></button>
                </div>
            </div>
            <div class="section-divider"></div>
            <div class="card ribbon" id="welcomeCard">
                <div class="welcome-message">
                    <i class="fas fa-globe"></i>
                    <h2>Welcome</h2>
                    <p>Select a workspace to start collaborating</p>
                </div>
            </div>
            <div class="page-header" style="margin-top:1rem;">
                <h2>Workspaces</h2>
            </div>
            <div class="workspace-list" id="workspaceList"></div>
        </section>
    </main>
    <div class="modal" id="createWorkspaceModal">
        <div class="modal-content">
            <div class="modal-header"><h2>Create Workspace</h2><button class="close-btn" id="closeCreateWorkspace">&times;</button></div>
            <form id="createWorkspaceForm">
                <div class="form-group"><label for="workspaceNameInput">Workspace Name</label><input type="text" id="workspaceNameInput" required></div>
                <div class="form-group"><label for="workspaceDescription">Description</label><textarea id="workspaceDescription" rows="3"></textarea></div>
                <button type="submit" class="btn btn-primary btn-full">Create Workspace</button>
            </form>
        </div>
    </div>
    <script src="common.js"></script>
    <script>
    const token = requireAuth('login.html');
    const currentUser = getCurrentUser();
    document.getElementById('userMenu').style.display = 'flex';
    document.getElementById('userMenu').innerHTML = `<span>${currentUser.first_name} ${currentUser.last_name} (${currentUser.role})</span>`;
    document.getElementById('logoutBtn').addEventListener('click', () => { clearAuth(); go('login.html'); });
    document.getElementById('logoutBtn').classList.add('btn-header');

    async function loadWorkspaces() {
        const res = await fetch(`${API_BASE_URL}/workspaces`, { headers: { 'Authorization': `Bearer ${token}` } });
        if (!res.ok) return;
        const workspaces = await res.json();
        const list = document.getElementById('workspaceList');
        list.innerHTML = '';
        workspaces.forEach(w => {
            const el = document.createElement('div');
            el.className = 'workspace-item';
            el.innerHTML = `<div style="display:flex; justify-content:space-between; align-items:center; width:100%;">
                <div>
                    <div style="font-weight:600;">${w.name}</div>
                    <div style="font-size:12px; color:#666;">ID: ${w.id}</div>
                </div>
                <div class="badge">${w.role}</div>
            </div>`;
            el.addEventListener('click', () => go(`workspace.html?id=${w.id}`));
            list.appendChild(el);
        });
    }

    // Hero CTA
    const heroActionBtn = document.getElementById('heroActionBtn');
    const heroActionText = document.getElementById('heroActionText');
    if (currentUser.role === 'student') {
        heroActionText.textContent = 'Join Workspace';
        heroActionBtn.innerHTML = '<i class="fas fa-user-plus"></i> <span>Join Workspace</span>';
        heroActionBtn.addEventListener('click', () => go('workspace-invitations.html'));
    } else {
        heroActionBtn.addEventListener('click', () => {
            document.getElementById('createWorkspaceModal').style.display = 'flex';
            document.getElementById('createWorkspaceModal').classList.add('show');
        });
    }
    document.getElementById('closeCreateWorkspace').addEventListener('click', () => {
        document.getElementById('createWorkspaceModal').classList.remove('show');
        document.getElementById('createWorkspaceModal').style.display = 'none';
    });
    document.getElementById('createWorkspaceForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const payload = { name: document.getElementById('workspaceNameInput').value, description: document.getElementById('workspaceDescription').value };
        const res = await fetch(`${API_BASE_URL}/workspaces`, { method:'POST', headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` }, body: JSON.stringify(payload) });
        const data = await res.json();
        if (res.ok) {
            notify(`Workspace created (ID: ${data.workspace.id})`,'success');
            document.getElementById('createWorkspaceForm').reset();
            document.getElementById('closeCreateWorkspace').click();
            loadWorkspaces();
        } else { notify(data.error || 'Failed','error'); }
    });

    loadWorkspaces();
    // Hide Requests for non-students
    const reqLink = document.querySelector('a[href="requests.html"]');
    if (reqLink && currentUser.role !== 'student') { reqLink.style.display = 'none'; }
    </script>
</body>
</html>


