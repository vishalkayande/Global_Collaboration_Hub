<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Projects - Global Collaboration Hub</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar">
        <div class="nav-brand"><i class="fas fa-globe"></i><span>Global Collaboration Hub</span></div>
        <button class="btn btn-outline" onclick="go('dashboard.html')">Back</button>
    </nav>
    <main class="main-content">
        <div class="workspace-content">
            <h2>Projects</h2>
            <div id="roleArea"></div>
            <div style="margin-top:16px;">
                <h3>My Projects</h3>
                <div id="projectList"></div>
            </div>
        </div>
    </main>
    <script src="common.js"></script>
    <script>
    const token = requireAuth('login.html');
    const me = getCurrentUser();
    const area = document.getElementById('roleArea');
    if (me.role === 'external' || me.role === 'admin') {
        area.innerHTML = `<div class='modal-content' style='max-width:720px; margin:0 auto;'>
            <h3>Create Project</h3>
            <div class='form-group'><label>Title</label><input id='p_title'></div>
            <div class='form-group'><label>Description</label><textarea id='p_desc' rows='3'></textarea></div>
            <div class='form-group'><label>Workspace</label><select id='p_ws'></select></div>
            <button class='btn btn-primary' id='p_create'>Create</button>
        </div>`;
        // Load my workspaces
        (async () => {
            const res = await fetch(`${API_BASE_URL}/workspaces`, { headers:{ 'Authorization': `Bearer ${token}` } });
            const arr = res.ok ? await res.json() : [];
            const sel = document.getElementById('p_ws');
            sel.innerHTML = arr.map(w => `<option value="${w.id}">${w.name} (ID: ${w.id})</option>`).join('');
        })();
        document.getElementById('p_create').addEventListener('click', async () => {
            const wsid = Number(document.getElementById('p_ws').value);
            const payload = { title: document.getElementById('p_title').value, description: document.getElementById('p_desc').value, workspace_id: wsid };
            const res = await fetch(`${API_BASE_URL}/projects`, { method:'POST', headers:{ 'Content-Type':'application/json','Authorization': `Bearer ${token}` }, body: JSON.stringify(payload) });
            const d = await res.json(); if (res.ok) { notify('Project created','success'); loadProjects(); } else { notify(d.error||'Failed','error'); }
        });
    } else if (me.role === 'student') {
        area.innerHTML = `<div class='modal-content' style='max-width:720px; margin:0 auto;'>
            <h3>Submit Project Work</h3>
            <div class='form-group'><label>Project ID</label><input id='s_pid'></div>
            <div class='form-group'><label>Content URL</label><input id='s_url' placeholder='e.g., GitHub repo / Drive link'></div>
            <div class='form-group'><label>Notes</label><textarea id='s_notes' rows='3'></textarea></div>
            <button class='btn btn-primary' id='s_submit'>Submit</button>
        </div>`;
        document.getElementById('s_submit').addEventListener('click', async () => {
            const pid = Number(document.getElementById('s_pid').value); if (!pid) return notify('Enter Project ID','error');
            const payload = { content_url: document.getElementById('s_url').value, notes: document.getElementById('s_notes').value };
            const res = await fetch(`${API_BASE_URL}/projects/${pid}/submit`, { method:'POST', headers:{ 'Content-Type':'application/json','Authorization': `Bearer ${token}` }, body: JSON.stringify(payload) });
            const d = await res.json(); if (res.ok) { notify('Submitted','success'); loadProjects(); } else { notify(d.error||'Failed','error'); }
        });
    }
    async function loadProjects() {
        const res = await fetch(`${API_BASE_URL}/projects`, { headers:{ 'Authorization': `Bearer ${token}` } });
        const list = document.getElementById('projectList'); list.innerHTML = '';
        if (!res.ok) { list.textContent = 'Not authorized'; return; }
        const arr = await res.json();
        if (!arr.length) { list.textContent = 'No projects yet'; return; }
        arr.forEach(p => { const div = document.createElement('div'); div.className='task-item'; div.innerHTML = `<div class='task-header'><div class='task-title'>${p.title}</div><div>${p.status}</div></div><div class='task-meta'>Workspace ID: ${p.workspace_id||'-'} â€¢ Created: ${new Date(p.created_at).toLocaleDateString()}</div><div>${p.description||''}</div>`; list.appendChild(div); });
    }
    loadProjects();
    </script>
</body>
</html>


